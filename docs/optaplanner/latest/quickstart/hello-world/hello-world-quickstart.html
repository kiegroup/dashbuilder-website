<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hello world Java quick start :: Documentation</title>
    <link rel="canonical" href="https://www.optaplanner.org/docs/optaplanner/latest/quickstart/hello-world/hello-world-quickstart.html">
    <meta name="generator" content="Antora 2.3.3">
    <link rel="stylesheet" href="../../../../_/css/site.css">
<link rel="stylesheet" href="../../../../_/css/search.css">
<link rel="stylesheet" href="../../../../_/css/menu.css"><!-- Adobe Analytics for Red Hat - DPAL (DTM Property Auto-Loader) - part 1/2 -->
<script id="dpal" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
<!-- Google Analytics for kie team: Global site tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-39485370-1"></script>
<script>
    window.dataLayer=window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments)
    };
    gtag('js',new Date());
    gtag('config','UA-39485370-1')
</script>
<script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="../../../../_/../../">
          <img src="../../../../_/img/optaPlannerLogoDarkBackground200px.png" alt="OptaPlanner logo"/>
        </a>
        <a class="navbar-item" href="https://www.optaplanner.org/docs">Documentation</a>
      </div>
      <div class="navbar-item hide-for-print">
        <input id="search-input" type="text" placeholder="Search docs">
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://docs.optaplanner.org">Archive</a>
        <div class="navbar-item">
          <a class="navbar-item small-item" href="https://github.com/kiegroup/kie-tools" title="Follow KIE Tools on GitHub"><div class="github-icon"></div></a>
          <a class="navbar-item small-item" href="https://mobile.twitter.com/dashbuilder" target="_blank" title="Follow DashBuilder on Twitter"><img alt="T" src="../../../../_/img/twitterLogo.png"></a>
          <a class="navbar-item small-item" href="https://www.youtube.com/channel/UCZvoXHoI4HIbKf9i-JO2jYA" target="_blank" title="DashBuilder YouTube channel"><img alt="YT" src="../../../../_/img/youtubeLogo.png" style="height: 16px"></a>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="optaplanner" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">OptaPlanner User Guide 8.16.1.Final</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../planner-introduction/planner-introduction.html">OptaPlanner Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Quickstart</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview/overview-quickstarts.html">Overview</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="hello-world-quickstart.html">Hello world Java quick start</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quarkus/quarkus-quickstart.html">Quarkus Java quick start</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spring-boot/spring-boot-quickstart.html">Spring Boot Java quick start</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../use-cases-and-examples/use-cases-and-examples.html">Use cases and examples</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../planner-configuration/planner-configuration.html">OptaPlanner configuration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../score-calculation/score-calculation.html">Score calculation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../constraint-streams/constraint-streams.html">Constraint streams score calculation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../drools-score-calculation/drools-score-calculation.html">Drools score calculation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../shadow-variable/shadow-variable.html">Shadow variable</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../optimization-algorithms/optimization-algorithms.html">Optimization algorithms</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../move-and-neighborhood-selection/move-and-neighborhood-selection.html">Move and neighborhood selection</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../exhaustive-search/exhaustive-search.html">Exhaustive search</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../construction-heuristics/construction-heuristics.html">Construction heuristics</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../local-search/local-search.html">Local search</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../evolutionary-algorithms/evolutionary-algorithms.html">Evolutionary algorithms</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../hyperheuristics/hyperheuristic.html">Hyperheuristics</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../partitioned-search/partitioned-search.html">Partitioned search</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../benchmarking-and-tweaking/benchmarking-and-tweaking.html">Benchmarking and tweaking</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../repeated-planning/repeated-planning.html">Repeated planning</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../integration/integration.html">Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../design-patterns/design-patterns.html">Design patterns</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../development/development.html">Development</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OptaPlanner User Guide 8.16.1.Final</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../index.html">OptaPlanner User Guide 8.16.1.Final</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../planner-introduction/planner-introduction.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">OptaPlanner User Guide 8.16.1.Final</a></li>
    <li>Quickstart</li>
    <li><a href="hello-world-quickstart.html">Hello world Java quick start</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/kiegroup/optaplanner/edit/main/optaplanner-docs/src/modules/ROOT/pages/quickstart/hello-world/hello-world-quickstart.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Hello world Java quick start</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This guide walks you through the process of creating a simple Java application
with <a href="https://www.optaplanner.org/">OptaPlanner</a>'s constraint solving Artificial Intelligence (AI).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_you_will_build"><a class="anchor" href="#_what_you_will_build"></a>1. What you will build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You will build a command-line application that optimizes a school timetable for students and teachers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...
INFO  Solving ended: time spent (5000), best score (0hard/9soft), ...
INFO
INFO  |            | Room A     | Room B     | Room C     |
INFO  |------------|------------|------------|------------|
INFO  | MON 08:30  | English    | Math       |            |
INFO  |            | I. Jones   | A. Turing  |            |
INFO  |            | 9th grade  | 10th grade |            |
INFO  |------------|------------|------------|------------|
INFO  | MON 09:30  | History    | Physics    |            |
INFO  |            | I. Jones   | M. Curie   |            |
INFO  |            | 9th grade  | 10th grade |            |
INFO  |------------|------------|------------|------------|
INFO  | MON 10:30  | History    | Physics    |            |
INFO  |            | I. Jones   | M. Curie   |            |
INFO  |            | 10th grade | 9th grade  |            |
INFO  |------------|------------|------------|------------|
...
INFO  |------------|------------|------------|------------|</pre>
</div>
</div>
<div class="paragraph">
<p>Your application will assign <code>Lesson</code> instances to <code>Timeslot</code> and <code>Room</code> instances automatically
by using AI to adhere to hard and soft scheduling <em>constraints</em>, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A room can have at most one lesson at the same time.</p>
</li>
<li>
<p>A teacher can teach at most one lesson at the same time.</p>
</li>
<li>
<p>A student can attend at most one lesson at the same time.</p>
</li>
<li>
<p>A teacher prefers to teach all lessons in the same room.</p>
</li>
<li>
<p>A teacher prefers to teach sequential lessons and dislikes gaps between lessons.</p>
</li>
<li>
<p>A student dislikes sequential lessons on the same subject.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Mathematically speaking, school timetabling is an <em>NP-hard</em> problem.
This means it is difficult to scale.
Simply brute force iterating through all possible combinations takes millions of years
for a non-trivial dataset, even on a supercomputer.
Fortunately, AI constraint solvers such as OptaPlanner have advanced algorithms
that deliver a near-optimal solution in a reasonable amount of time.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_solution_source_code"><a class="anchor" href="#_solution_source_code"></a>2. Solution source code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Follow the instructions in the next sections to create the application step by step (recommended).</p>
</div>
<div class="paragraph">
<p>Alternatively, review the completed example:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Complete one of the following tasks:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Clone the Git repository:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ git clone https://github.com/kiegroup/optaplanner-quickstarts</code></pre>
</div>
</div>
</li>
<li>
<p>Download an <a href="https://www.optaplanner.org/download/download.html">archive</a>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Find the solution in <a href="https://github.com/kiegroup/optaplanner-quickstarts/tree/stable/hello-world">the <code>hello-world</code> directory</a>.</p>
</li>
<li>
<p>Follow the instructions in the README file to run the application.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>3. Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://adoptopenjdk.net/">JDK</a> 11+ with <code>JAVA_HOME</code> configured appropriately</p>
</li>
<li>
<p><a href="https://maven.apache.org/download.html">Apache Maven</a> 3.6.3+ or <a href="https://gradle.org/install/">Gradle</a> 4+</p>
</li>
<li>
<p>An IDE, such as <a href="https://www.jetbrains.com/idea">IntelliJ IDEA</a>, VSCode or Eclipse</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_build_file_and_the_dependencies"><a class="anchor" href="#_the_build_file_and_the_dependencies"></a>4. The build file and the dependencies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create a Maven or Gradle build file and add these dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>optaplanner-core</code> (compile scope) to solve the school timetable problem.</p>
</li>
<li>
<p><code>optaplanner-test</code> (test scope) to JUnit test the school timetabling constraints.</p>
</li>
<li>
<p>A <a href="../../planner-configuration/planner-configuration.html#logging" class="page">logging</a> implementation, such as <code>logback-classic</code> (runtime scope), to see what OptaPlanner is doing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you choose Maven, your <code>pom.xml</code> file has the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

  &lt;groupId&gt;org.acme&lt;/groupId&gt;
  &lt;artifactId&gt;optaplanner-hello-world-school-timetabling-quickstart&lt;/artifactId&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

  &lt;properties&gt;
    &lt;maven.compiler.release&gt;11&lt;/maven.compiler.release&gt;
    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
  &lt;/properties&gt;

  &lt;dependencyManagement&gt;
    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;org.optaplanner&lt;/groupId&gt;
        &lt;artifactId&gt;optaplanner-bom&lt;/artifactId&gt;
        &lt;version&gt;8.16.1.Final&lt;/version&gt;
        &lt;type&gt;pom&lt;/type&gt;
        &lt;scope&gt;import&lt;/scope&gt;
      &lt;/dependency&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
        &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
        &lt;version&gt;1.2.3&lt;/version&gt;
      &lt;/dependency&gt;
    &lt;/dependencies&gt;
  &lt;/dependencyManagement&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.optaplanner&lt;/groupId&gt;
      &lt;artifactId&gt;optaplanner-core&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
      &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
    &lt;/dependency&gt;

    &lt;!-- Testing --&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.optaplanner&lt;/groupId&gt;
      &lt;artifactId&gt;optaplanner-test&lt;/artifactId&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.0.0&lt;/version&gt;
        &lt;configuration&gt;
          &lt;mainClass&gt;org.acme.schooltimetabling.TimeTableApp&lt;/mainClass&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>On the other hand, in Gradle, your <code>build.gradle</code> file has this content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">plugins {
    id "java"
    id "application"
}

def optaplannerVersion = "8.16.1.Final"
def logbackVersion = "1.2.9"

group = "org.acme"
version = "1.0-SNAPSHOT"

repositories {
    mavenCentral()
}

dependencies {
    implementation platform("org.optaplanner:optaplanner-bom:${optaplannerVersion}")
    implementation "org.optaplanner:optaplanner-core"
    testImplementation "org.optaplanner:optaplanner-test"

    runtimeOnly "ch.qos.logback:logback-classic:${logbackVersion}"
}

java {
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}

compileJava {
    options.encoding = "UTF-8"
    options.compilerArgs &lt;&lt; "-parameters"
}

compileTestJava {
    options.encoding = "UTF-8"
}

application {
    mainClass = "org.acme.schooltimetabling.TimeTableApp"
}

test {
    // Log the test execution results.
    testLogging {
        events "passed", "skipped", "failed"
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_model_the_domain_objects"><a class="anchor" href="#_model_the_domain_objects"></a>5. Model the domain objects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Your goal is to assign each lesson to a time slot and a room.
You will create these classes:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/quickstart/school-timetabling/schoolTimetablingClassDiagramPure.png" alt="schoolTimetablingClassDiagramPure">
</div>
</div>
<div class="sect2">
<h3 id="_timeslot"><a class="anchor" href="#_timeslot"></a>5.1. Timeslot</h3>
<div class="paragraph">
<p>The <code>Timeslot</code> class represents a time interval when lessons are taught,
for example, <code>Monday 10:30 - 11:30</code> or <code>Tuesday 13:30 - 14:30</code>.
For simplicity&#8217;s sake, all time slots have the same duration
and there are no time slots during lunch or other breaks.</p>
</div>
<div class="paragraph">
<p>A time slot has no date, because a high school schedule just repeats every week.
So there is no need for <a href="../../repeated-planning/repeated-planning.html#continuousPlanning" class="page">continuous planning</a>.</p>
</div>
<div class="paragraph">
<p>Create the <code>src/main/java/org/acme/schooltimetabling/domain/Timeslot.java</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.schooltimetabling.domain;

import java.time.DayOfWeek;
import java.time.LocalTime;

public class Timeslot {

    private DayOfWeek dayOfWeek;
    private LocalTime startTime;
    private LocalTime endTime;

    public Timeslot() {
    }

    public Timeslot(DayOfWeek dayOfWeek, LocalTime startTime, LocalTime endTime) {
        this.dayOfWeek = dayOfWeek;
        this.startTime = startTime;
        this.endTime = endTime;
    }

    public DayOfWeek getDayOfWeek() {
        return dayOfWeek;
    }

    public LocalTime getStartTime() {
        return startTime;
    }

    public LocalTime getEndTime() {
        return endTime;
    }

    @Override
    public String toString() {
        return dayOfWeek + " " + startTime;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because no <code>Timeslot</code> instances change during solving, a <code>Timeslot</code> is called a <em>problem fact</em>.
Such classes do not require any OptaPlanner specific annotations.</p>
</div>
<div class="paragraph">
<p>Notice the <code>toString()</code> method keeps the output short,
so it is easier to read OptaPlanner&#8217;s <code>DEBUG</code> or <code>TRACE</code> log, as shown later.</p>
</div>
</div>
<div class="sect2">
<h3 id="_room"><a class="anchor" href="#_room"></a>5.2. Room</h3>
<div class="paragraph">
<p>The <code>Room</code> class represents a location where lessons are taught,
for example, <code>Room A</code> or <code>Room B</code>.
For simplicity&#8217;s sake, all rooms are without capacity limits
and they can accommodate all lessons.</p>
</div>
<div class="paragraph">
<p>Create the <code>src/main/java/org/acme/schooltimetabling/domain/Room.java</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.schooltimetabling.domain;

public class Room {

    private String name;

    public Room() {
    }

    public Room(String name) {
        this.name = name;
    }

    public String getName() {
        return name;
    }

    @Override
    public String toString() {
        return name;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Room</code> instances do not change during solving, so <code>Room</code> is also a <em>problem fact</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_lesson"><a class="anchor" href="#_lesson"></a>5.3. Lesson</h3>
<div class="paragraph">
<p>During a lesson, represented by the <code>Lesson</code> class,
a teacher teaches a subject to a group of students,
for example, <code>Math by A.Turing for 9th grade</code> or <code>Chemistry by M.Curie for 10th grade</code>.
If a subject is taught multiple times per week by the same teacher to the same student group,
there are multiple <code>Lesson</code> instances that are only distinguishable by <code>id</code>.
For example, the 9th grade has six math lessons a week.</p>
</div>
<div class="paragraph">
<p>During solving, OptaPlanner changes the <code>timeslot</code> and <code>room</code> fields of the <code>Lesson</code> class,
to assign each lesson to a time slot and a room.
Because OptaPlanner changes these fields, <code>Lesson</code> is a <em>planning entity</em>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/quickstart/school-timetabling/schoolTimetablingClassDiagramAnnotated.png" alt="schoolTimetablingClassDiagramAnnotated">
</div>
</div>
<div class="paragraph">
<p>Most of the fields in the previous diagram contain input data, except for the orange fields:
A lesson&#8217;s <code>timeslot</code> and <code>room</code> fields are unassigned (<code>null</code>) in the input data
and assigned (not <code>null</code>) in the output data.
OptaPlanner changes these fields during solving.
Such fields are called planning variables.
In order for OptaPlanner to recognize them,
both the <code>timeslot</code> and <code>room</code> fields require an <code>@PlanningVariable</code> annotation.
Their containing class, <code>Lesson</code>, requires an <code>@PlanningEntity</code> annotation.</p>
</div>
<div class="paragraph">
<p>Create the <code>src/main/java/org/acme/schooltimetabling/domain/Lesson.java</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.schooltimetabling.domain;

import org.optaplanner.core.api.domain.entity.PlanningEntity;
import org.optaplanner.core.api.domain.lookup.PlanningId;
import org.optaplanner.core.api.domain.variable.PlanningVariable;

@PlanningEntity
public class Lesson {

    @PlanningId
    private Long id;

    private String subject;
    private String teacher;
    private String studentGroup;

    @PlanningVariable(valueRangeProviderRefs = "timeslotRange")
    private Timeslot timeslot;
    @PlanningVariable(valueRangeProviderRefs = "roomRange")
    private Room room;

    public Lesson() {
    }

    public Lesson(Long id, String subject, String teacher, String studentGroup) {
        this.id = id;
        this.subject = subject;
        this.teacher = teacher;
        this.studentGroup = studentGroup;
    }

    public Long getId() {
        return id;
    }

    public String getSubject() {
        return subject;
    }

    public String getTeacher() {
        return teacher;
    }

    public String getStudentGroup() {
        return studentGroup;
    }

    public Timeslot getTimeslot() {
        return timeslot;
    }

    public void setTimeslot(Timeslot timeslot) {
        this.timeslot = timeslot;
    }

    public Room getRoom() {
        return room;
    }

    public void setRoom(Room room) {
        this.room = room;
    }

    @Override
    public String toString() {
        return subject + "(" + id + ")";
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Lesson</code> class has an <code>@PlanningEntity</code> annotation,
so OptaPlanner knows that this class changes during solving
because it contains one or more planning variables.</p>
</div>
<div class="paragraph">
<p>The <code>timeslot</code> field has an <code>@PlanningVariable</code> annotation,
so OptaPlanner knows that it can change its value.
In order to find potential <code>Timeslot</code> instances to assign to this field,
OptaPlanner uses the <code>valueRangeProviderRefs</code> property to connect to a value range provider
(explained later) that provides a <code>List&lt;Timeslot&gt;</code> to pick from.</p>
</div>
<div class="paragraph">
<p>The <code>room</code> field also has an <code>@PlanningVariable</code> annotation, for the same reasons.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Determining the <code>@PlanningVariable</code> fields for an arbitrary constraint solving use case
is often challenging the first time.
Read <a href="../../design-patterns/design-patterns.html#domainModelingGuide" class="page">the domain modeling guidelines</a> to avoid common pitfalls.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_define_the_constraints_and_calculate_the_score"><a class="anchor" href="#_define_the_constraints_and_calculate_the_score"></a>6. Define the constraints and calculate the score</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <em>score</em> represents the quality of a specific solution.
The higher the better.
OptaPlanner looks for the best solution, which is the solution with the highest score found in the available time.
It might be the <em>optimal</em> solution.</p>
</div>
<div class="paragraph">
<p>Because this use case has hard and soft constraints,
use the <code>HardSoftScore</code> class to represent the score:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hard constraints must not be broken. For example: <em>A room can have at most one lesson at the same time.</em></p>
</li>
<li>
<p>Soft constraints should not be broken. For example: <em>A teacher prefers to teach in a single room.</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hard constraints are weighted against other hard constraints.
Soft constraints are weighted too, against other soft constraints.
<strong>Hard constraints always outweigh soft constraints</strong>, regardless of their respective weights.</p>
</div>
<div class="paragraph">
<p>To calculate the score, you could implement an <code>EasyScoreCalculator</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class TimeTableEasyScoreCalculator implements EasyScoreCalculator&lt;TimeTable, HardSoftScore&gt; {

    @Override
    public HardSoftScore calculateScore(TimeTable timeTable) {
        List&lt;Lesson&gt; lessonList = timeTable.getLessonList();
        int hardScore = 0;
        for (Lesson a : lessonList) {
            for (Lesson b : lessonList) {
                if (a.getTimeslot() != null &amp;&amp; a.getTimeslot().equals(b.getTimeslot())
                        &amp;&amp; a.getId() &lt; b.getId()) {
                    // A room can accommodate at most one lesson at the same time.
                    if (a.getRoom() != null &amp;&amp; a.getRoom().equals(b.getRoom())) {
                        hardScore--;
                    }
                    // A teacher can teach at most one lesson at the same time.
                    if (a.getTeacher().equals(b.getTeacher())) {
                        hardScore--;
                    }
                    // A student can attend at most one lesson at the same time.
                    if (a.getStudentGroup().equals(b.getStudentGroup())) {
                        hardScore--;
                    }
                }
            }
        }
        int softScore = 0;
        // Soft constraints are only implemented in the optaplanner-quickstarts code
        return HardSoftScore.of(hardScore, softScore);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unfortunately <strong>that does not scale well</strong>, because it is non-incremental:
every time a lesson is assigned to a different time slot or room,
all lessons are re-evaluated to calculate the new score.</p>
</div>
<div class="paragraph">
<p>Instead, create a <code>src/main/java/org/acme/schooltimetabling/solver/TimeTableConstraintProvider.java</code> class
to perform incremental score calculation.
It uses OptaPlanner&#8217;s ConstraintStream API which is inspired by Java Streams and SQL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.schooltimetabling.solver;

import org.acme.schooltimetabling.domain.Lesson;
import org.optaplanner.core.api.score.buildin.hardsoft.HardSoftScore;
import org.optaplanner.core.api.score.stream.Constraint;
import org.optaplanner.core.api.score.stream.ConstraintFactory;
import org.optaplanner.core.api.score.stream.ConstraintProvider;
import org.optaplanner.core.api.score.stream.Joiners;

public class TimeTableConstraintProvider implements ConstraintProvider {

    @Override
    public Constraint[] defineConstraints(ConstraintFactory constraintFactory) {
        return new Constraint[] {
                // Hard constraints
                roomConflict(constraintFactory),
                teacherConflict(constraintFactory),
                studentGroupConflict(constraintFactory),
                // Soft constraints are only implemented in the optaplanner-quickstarts code
        };
    }

    private Constraint roomConflict(ConstraintFactory constraintFactory) {
        // A room can accommodate at most one lesson at the same time.

        // Select a lesson ...
        return constraintFactory
                .forEach(Lesson.class)
                // ... and pair it with another lesson ...
                .join(Lesson.class,
                        // ... in the same timeslot ...
                        Joiners.equal(Lesson::getTimeslot),
                        // ... in the same room ...
                        Joiners.equal(Lesson::getRoom),
                        // ... and the pair is unique (different id, no reverse pairs) ...
                        Joiners.lessThan(Lesson::getId))
                // ... then penalize each pair with a hard weight.
                .penalize("Room conflict", HardSoftScore.ONE_HARD);
    }

    private Constraint teacherConflict(ConstraintFactory constraintFactory) {
        // A teacher can teach at most one lesson at the same time.
        return constraintFactory.forEach(Lesson.class)
                .join(Lesson.class,
                        Joiners.equal(Lesson::getTimeslot),
                        Joiners.equal(Lesson::getTeacher),
                        Joiners.lessThan(Lesson::getId))
                .penalize("Teacher conflict", HardSoftScore.ONE_HARD);
    }

    private Constraint studentGroupConflict(ConstraintFactory constraintFactory) {
        // A student can attend at most one lesson at the same time.
        return constraintFactory.forEach(Lesson.class)
                .join(Lesson.class,
                        Joiners.equal(Lesson::getTimeslot),
                        Joiners.equal(Lesson::getStudentGroup),
                        Joiners.lessThan(Lesson::getId))
                .penalize("Student group conflict", HardSoftScore.ONE_HARD);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ConstraintProvider</code> scales an order of magnitude better than the <code>EasyScoreCalculator</code>: <em>O</em>(n) instead of <em>O</em>(nÂ²).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gather_the_domain_objects_in_a_planning_solution"><a class="anchor" href="#_gather_the_domain_objects_in_a_planning_solution"></a>7. Gather the domain objects in a planning solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <code>TimeTable</code> wraps all <code>Timeslot</code>, <code>Room</code>, and <code>Lesson</code> instances of a single dataset.
Furthermore, because it contains all lessons, each with a specific planning variable state,
it is a <em>planning solution</em> and it has a score:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If lessons are still unassigned, then it is an <em>uninitialized</em> solution,
for example, a solution with the score <code>-4init/0hard/0soft</code>.</p>
</li>
<li>
<p>If it breaks hard constraints, then it is an <em>infeasible</em> solution,
for example, a solution with the score <code>-2hard/-3soft</code>.</p>
</li>
<li>
<p>If it adheres to all hard constraints, then it is a <em>feasible</em> solution,
for example, a solution with the score <code>0hard/-7soft</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Create the <code>src/main/java/org/acme/schooltimetabling/domain/TimeTable.java</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.schooltimetabling.domain;

import java.util.List;

import org.optaplanner.core.api.domain.solution.PlanningEntityCollectionProperty;
import org.optaplanner.core.api.domain.solution.PlanningScore;
import org.optaplanner.core.api.domain.solution.PlanningSolution;
import org.optaplanner.core.api.domain.solution.ProblemFactCollectionProperty;
import org.optaplanner.core.api.domain.valuerange.ValueRangeProvider;
import org.optaplanner.core.api.score.buildin.hardsoft.HardSoftScore;

@PlanningSolution
public class TimeTable {

    @ValueRangeProvider(id = "timeslotRange")
    @ProblemFactCollectionProperty
    private List&lt;Timeslot&gt; timeslotList;
    @ValueRangeProvider(id = "roomRange")
    @ProblemFactCollectionProperty
    private List&lt;Room&gt; roomList;
    @PlanningEntityCollectionProperty
    private List&lt;Lesson&gt; lessonList;

    @PlanningScore
    private HardSoftScore score;

    public TimeTable() {
    }

    public TimeTable(List&lt;Timeslot&gt; timeslotList, List&lt;Room&gt; roomList, List&lt;Lesson&gt; lessonList) {
        this.timeslotList = timeslotList;
        this.roomList = roomList;
        this.lessonList = lessonList;
    }

    public List&lt;Timeslot&gt; getTimeslotList() {
        return timeslotList;
    }

    public List&lt;Room&gt; getRoomList() {
        return roomList;
    }

    public List&lt;Lesson&gt; getLessonList() {
        return lessonList;
    }

    public HardSoftScore getScore() {
        return score;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>TimeTable</code> class has an <code>@PlanningSolution</code> annotation,
so OptaPlanner knows that this class contains all of the input and output data.</p>
</div>
<div class="paragraph">
<p>Specifically, this class is the input of the problem:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>timeslotList</code> field with all time slots</p>
<div class="ulist">
<ul>
<li>
<p>This is a list of problem facts, because they do not change during solving.</p>
</li>
</ul>
</div>
</li>
<li>
<p>A <code>roomList</code> field with all rooms</p>
<div class="ulist">
<ul>
<li>
<p>This is a list of problem facts, because they do not change during solving.</p>
</li>
</ul>
</div>
</li>
<li>
<p>A <code>lessonList</code> field with all lessons</p>
<div class="ulist">
<ul>
<li>
<p>This is a list of planning entities, because they change during solving.</p>
</li>
<li>
<p>Of each <code>Lesson</code>:</p>
<div class="ulist">
<ul>
<li>
<p>The values of the <code>timeslot</code> and <code>room</code> fields are typically still <code>null</code>, so unassigned.
They are planning variables.</p>
</li>
<li>
<p>The other fields, such as <code>subject</code>, <code>teacher</code> and <code>studentGroup</code>, are filled in.
These fields are problem properties.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, this class is also the output of the solution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>lessonList</code> field for which each <code>Lesson</code> instance has non-null <code>timeslot</code> and <code>room</code> fields after solving</p>
</li>
<li>
<p>A <code>score</code> field that represents the quality of the output solution, for example, <code>0hard/-5soft</code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_the_value_range_providers"><a class="anchor" href="#_the_value_range_providers"></a>7.1. The value range providers</h3>
<div class="paragraph">
<p>The <code>timeslotList</code> field is a value range provider.
It holds the <code>Timeslot</code> instances which OptaPlanner can pick from to assign to the <code>timeslot</code> field of <code>Lesson</code> instances.
The <code>timeslotList</code> field has an <code>@ValueRangeProvider</code> annotation to connect the <code>@PlanningVariable</code> with the <code>@ValueRangeProvider</code>,
by matching the value of the <code>id</code> property with the value of the <code>valueRangeProviderRefs</code> property of the <code>@PlanningVariable</code> annotation in the <code>Lesson</code> class.</p>
</div>
<div class="paragraph">
<p>Following the same logic, the <code>roomList</code> field also has an <code>@ValueRangeProvider</code> annotation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_problem_fact_and_planning_entity_properties"><a class="anchor" href="#_the_problem_fact_and_planning_entity_properties"></a>7.2. The problem fact and planning entity properties</h3>
<div class="paragraph">
<p>Furthermore, OptaPlanner needs to know which <code>Lesson</code> instances it can change
as well as how to retrieve the <code>Timeslot</code> and <code>Room</code> instances used for score calculation
by your <code>TimeTableConstraintProvider</code>.</p>
</div>
<div class="paragraph">
<p>The <code>timeslotList</code> and <code>roomList</code> fields have an <code>@ProblemFactCollectionProperty</code> annotation,
so your <code>TimeTableConstraintProvider</code> can select <em>from</em> those instances.</p>
</div>
<div class="paragraph">
<p>The <code>lessonList</code> has an <code>@PlanningEntityCollectionProperty</code> annotation,
so OptaPlanner can change them during solving
and your <code>TimeTableConstraintProvider</code> can select <em>from</em> those too.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_the_application"><a class="anchor" href="#_create_the_application"></a>8. Create the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now you are ready to put everything together and create a Java application.
The <code>main()</code> method performs the following tasks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Creates the <code>SolverFactory</code> to build a <code>Solver</code> per dataset.</p>
</li>
<li>
<p>Loads a dataset.</p>
</li>
<li>
<p>Solves it with <code>Solver.solve()</code>.</p>
</li>
<li>
<p>Visualizes the solution for that dataset.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Typically, an application has a single <code>SolverFactory</code>
to build a new <code>Solver</code> instance for each problem dataset to solve.
A <code>SolverFactory</code> is thread-safe, but a <code>Solver</code> is not.
In this case, there is only one dataset, so only one <code>Solver</code> instance.</p>
</div>
<div class="paragraph">
<p>Create the <code>src/main/java/org/acme/schooltimetabling/TimeTableApp.java</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.schooltimetabling;

import java.time.DayOfWeek;
import java.time.Duration;
import java.time.LocalTime;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

import org.acme.schooltimetabling.domain.Lesson;
import org.acme.schooltimetabling.domain.Room;
import org.acme.schooltimetabling.domain.TimeTable;
import org.acme.schooltimetabling.domain.Timeslot;
import org.acme.schooltimetabling.solver.TimeTableConstraintProvider;
import org.optaplanner.core.api.solver.Solver;
import org.optaplanner.core.api.solver.SolverFactory;
import org.optaplanner.core.config.solver.SolverConfig;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class TimeTableApp {

    private static final Logger LOGGER = LoggerFactory.getLogger(TimeTableApp.class);

    public static void main(String[] args) {
        SolverFactory&lt;TimeTable&gt; solverFactory = SolverFactory.create(new SolverConfig()
                .withSolutionClass(TimeTable.class)
                .withEntityClasses(Lesson.class)
                .withConstraintProviderClass(TimeTableConstraintProvider.class)
                // The solver runs only for 5 seconds on this small dataset.
                // It's recommended to run for at least 5 minutes ("5m") otherwise.
                .withTerminationSpentLimit(Duration.ofSeconds(10)));

        // Load the problem
        TimeTable problem = generateDemoData();

        // Solve the problem
        Solver&lt;TimeTable&gt; solver = solverFactory.buildSolver();
        TimeTable solution = solver.solve(problem);

        // Visualize the solution
        printTimetable(solution);
    }

    public static TimeTable generateDemoData() {
        List&lt;Timeslot&gt; timeslotList = new ArrayList&lt;&gt;(10);
        timeslotList.add(new Timeslot(DayOfWeek.MONDAY, LocalTime.of(8, 30), LocalTime.of(9, 30)));
        timeslotList.add(new Timeslot(DayOfWeek.MONDAY, LocalTime.of(9, 30), LocalTime.of(10, 30)));
        timeslotList.add(new Timeslot(DayOfWeek.MONDAY, LocalTime.of(10, 30), LocalTime.of(11, 30)));
        timeslotList.add(new Timeslot(DayOfWeek.MONDAY, LocalTime.of(13, 30), LocalTime.of(14, 30)));
        timeslotList.add(new Timeslot(DayOfWeek.MONDAY, LocalTime.of(14, 30), LocalTime.of(15, 30)));

        timeslotList.add(new Timeslot(DayOfWeek.TUESDAY, LocalTime.of(8, 30), LocalTime.of(9, 30)));
        timeslotList.add(new Timeslot(DayOfWeek.TUESDAY, LocalTime.of(9, 30), LocalTime.of(10, 30)));
        timeslotList.add(new Timeslot(DayOfWeek.TUESDAY, LocalTime.of(10, 30), LocalTime.of(11, 30)));
        timeslotList.add(new Timeslot(DayOfWeek.TUESDAY, LocalTime.of(13, 30), LocalTime.of(14, 30)));
        timeslotList.add(new Timeslot(DayOfWeek.TUESDAY, LocalTime.of(14, 30), LocalTime.of(15, 30)));

        List&lt;Room&gt; roomList = new ArrayList&lt;&gt;(3);
        roomList.add(new Room("Room A"));
        roomList.add(new Room("Room B"));
        roomList.add(new Room("Room C"));

        List&lt;Lesson&gt; lessonList = new ArrayList&lt;&gt;();
        long id = 0;
        lessonList.add(new Lesson(id++, "Math", "A. Turing", "9th grade"));
        lessonList.add(new Lesson(id++, "Math", "A. Turing", "9th grade"));
        lessonList.add(new Lesson(id++, "Physics", "M. Curie", "9th grade"));
        lessonList.add(new Lesson(id++, "Chemistry", "M. Curie", "9th grade"));
        lessonList.add(new Lesson(id++, "Biology", "C. Darwin", "9th grade"));
        lessonList.add(new Lesson(id++, "History", "I. Jones", "9th grade"));
        lessonList.add(new Lesson(id++, "English", "I. Jones", "9th grade"));
        lessonList.add(new Lesson(id++, "English", "I. Jones", "9th grade"));
        lessonList.add(new Lesson(id++, "Spanish", "P. Cruz", "9th grade"));
        lessonList.add(new Lesson(id++, "Spanish", "P. Cruz", "9th grade"));

        lessonList.add(new Lesson(id++, "Math", "A. Turing", "10th grade"));
        lessonList.add(new Lesson(id++, "Math", "A. Turing", "10th grade"));
        lessonList.add(new Lesson(id++, "Math", "A. Turing", "10th grade"));
        lessonList.add(new Lesson(id++, "Physics", "M. Curie", "10th grade"));
        lessonList.add(new Lesson(id++, "Chemistry", "M. Curie", "10th grade"));
        lessonList.add(new Lesson(id++, "French", "M. Curie", "10th grade"));
        lessonList.add(new Lesson(id++, "Geography", "C. Darwin", "10th grade"));
        lessonList.add(new Lesson(id++, "History", "I. Jones", "10th grade"));
        lessonList.add(new Lesson(id++, "English", "P. Cruz", "10th grade"));
        lessonList.add(new Lesson(id++, "Spanish", "P. Cruz", "10th grade"));

        return new TimeTable(timeslotList, roomList, lessonList);
    }

    private static void printTimetable(TimeTable timeTable) {
        LOGGER.info("");
        List&lt;Room&gt; roomList = timeTable.getRoomList();
        List&lt;Lesson&gt; lessonList = timeTable.getLessonList();
        Map&lt;Timeslot, Map&lt;Room, List&lt;Lesson&gt;&gt;&gt; lessonMap = lessonList.stream()
                .filter(lesson -&gt; lesson.getTimeslot() != null &amp;&amp; lesson.getRoom() != null)
                .collect(Collectors.groupingBy(Lesson::getTimeslot, Collectors.groupingBy(Lesson::getRoom)));
        LOGGER.info("|            | " + roomList.stream()
                .map(room -&gt; String.format("%-10s", room.getName())).collect(Collectors.joining(" | ")) + " |");
        LOGGER.info("|" + "------------|".repeat(roomList.size() + 1));
        for (Timeslot timeslot : timeTable.getTimeslotList()) {
            List&lt;List&lt;Lesson&gt;&gt; cellList = roomList.stream()
                    .map(room -&gt; {
                        Map&lt;Room, List&lt;Lesson&gt;&gt; byRoomMap = lessonMap.get(timeslot);
                        if (byRoomMap == null) {
                            return Collections.&lt;Lesson&gt;emptyList();
                        }
                        List&lt;Lesson&gt; cellLessonList = byRoomMap.get(room);
                        if (cellLessonList == null) {
                            return Collections.&lt;Lesson&gt;emptyList();
                        }
                        return cellLessonList;
                    })
                    .collect(Collectors.toList());

            LOGGER.info("| " + String.format("%-10s",
                    timeslot.getDayOfWeek().toString().substring(0, 3) + " " + timeslot.getStartTime()) + " | "
                    + cellList.stream().map(cellLessonList -&gt; String.format("%-10s",
                            cellLessonList.stream().map(Lesson::getSubject).collect(Collectors.joining(", "))))
                            .collect(Collectors.joining(" | "))
                    + " |");
            LOGGER.info("|            | "
                    + cellList.stream().map(cellLessonList -&gt; String.format("%-10s",
                            cellLessonList.stream().map(Lesson::getTeacher).collect(Collectors.joining(", "))))
                            .collect(Collectors.joining(" | "))
                    + " |");
            LOGGER.info("|            | "
                    + cellList.stream().map(cellLessonList -&gt; String.format("%-10s",
                            cellLessonList.stream().map(Lesson::getStudentGroup).collect(Collectors.joining(", "))))
                            .collect(Collectors.joining(" | "))
                    + " |");
            LOGGER.info("|" + "------------|".repeat(roomList.size() + 1));
        }
        List&lt;Lesson&gt; unassignedLessons = lessonList.stream()
                .filter(lesson -&gt; lesson.getTimeslot() == null || lesson.getRoom() == null)
                .collect(Collectors.toList());
        if (!unassignedLessons.isEmpty()) {
            LOGGER.info("");
            LOGGER.info("Unassigned lessons");
            for (Lesson lesson : unassignedLessons) {
                LOGGER.info("  " + lesson.getSubject() + " - " + lesson.getTeacher() + " - " + lesson.getStudentGroup());
            }
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>main()</code> method first creates the <code>SolverFactory</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">SolverFactory&lt;TimeTable&gt; solverFactory = SolverFactory.create(new SolverConfig()
        .withSolutionClass(TimeTable.class)
        .withEntityClasses(Lesson.class)
        .withConstraintProviderClass(TimeTableConstraintProvider.class)
        // The solver runs only for 5 seconds on this small dataset.
        // It's recommended to run for at least 5 minutes ("5m") otherwise.
        .withTerminationSpentLimit(Duration.ofSeconds(5)));</code></pre>
</div>
</div>
<div class="paragraph">
<p>This registers the <code>@PlanningSolution</code> class, the <code>@PlanningEntity</code> classes,
and the <code>ConstraintProvider</code> class, all of which you created earlier.</p>
</div>
<div class="paragraph">
<p>Without a termination setting or a <code>terminationEarly()</code> event, the solver runs forever.
To avoid that, the solver limits the solving time to five seconds.</p>
</div>
<div class="paragraph">
<p>After five seconds, the <code>main()</code> method loads the problem, solves it, and prints the solution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">        // Load the problem
        TimeTable problem = generateDemoData();

        // Solve the problem
        Solver&lt;TimeTable&gt; solver = solverFactory.buildSolver();
        TimeTable solution = solver.solve(problem);

        // Visualize the solution
        printTimetable(solution);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>solve()</code> method doesn&#8217;t return instantl. It runs for five seconds before returning the best solution.</p>
</div>
<div class="paragraph">
<p>OptaPlanner returns <em>the best solution</em> found in the available termination time.
Due to <a href="../../optimization-algorithms/optimization-algorithms.html#doesPlannerFindTheOptimalSolution" class="page">the nature of NP-hard problems</a>,
the best solution might not be optimal, especially for larger datasets.
Increase the termination time to potentially find a better solution.</p>
</div>
<div class="paragraph">
<p>The <code>generateDemoData()</code> method generates the school timetable problem to solve.</p>
</div>
<div class="paragraph">
<p>The <code>printTimetable()</code> method pretty prints the timetable to the console,
so it&#8217;s easy to determine visually whether or not it&#8217;s a good schedule.</p>
</div>
<div class="sect2">
<h3 id="_configure_logging"><a class="anchor" href="#_configure_logging"></a>8.1. Configure logging</h3>
<div class="paragraph">
<p>To see any output in the console, logging must be configured properly.</p>
</div>
<div class="paragraph">
<p>Create the <code>src/main/resource/logback.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;configuration&gt;

  &lt;appender name="consoleAppender" class="ch.qos.logback.core.ConsoleAppender"&gt;
    &lt;encoder&gt;
      &lt;pattern&gt;%d{HH:mm:ss.SSS} [%-12.12t] %-5p %m%n&lt;/pattern&gt;
    &lt;/encoder&gt;
  &lt;/appender&gt;

  &lt;logger name="org.optaplanner" level="info"/&gt;

  &lt;root level="info"&gt;
    &lt;appender-ref ref="consoleAppender" /&gt;
  &lt;/root&gt;

&lt;/configuration&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_run_the_application"><a class="anchor" href="#_run_the_application"></a>9. Run the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Run that <code>TimeTableApp</code> class as the main class of a normal Java application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...
INFO  |            | Room A     | Room B     | Room C     |
INFO  |------------|------------|------------|------------|
INFO  | MON 08:30  | English    | Math       |            |
INFO  |            | I. Jones   | A. Turing  |            |
INFO  |            | 9th grade  | 10th grade |            |
INFO  |------------|------------|------------|------------|
INFO  | MON 09:30  | History    | Physics    |            |
INFO  |            | I. Jones   | M. Curie   |            |
INFO  |            | 9th grade  | 10th grade |            |
...</pre>
</div>
</div>
<div class="paragraph">
<p>Verify the console output. Does it conform to all hard constraints?
What happens if you comment out the <code>roomConflict</code> constraint in <code>TimeTableConstraintProvider</code>?</p>
</div>
<div class="paragraph">
<p>The <code>info</code> log shows what OptaPlanner did in those five seconds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code>... Solving started: time spent (33), best score (-8init/0hard/0soft), environment mode (REPRODUCIBLE), random (JDK with seed 0).
... Construction Heuristic phase (0) ended: time spent (73), best score (0hard/0soft), score calculation speed (459/sec), step total (4).
... Local Search phase (1) ended: time spent (5000), best score (0hard/0soft), score calculation speed (28949/sec), step total (28398).
... Solving ended: time spent (5000), best score (0hard/0soft), score calculation speed (28524/sec), phase total (2), environment mode (REPRODUCIBLE).</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_test_the_application"><a class="anchor" href="#_test_the_application"></a>9.1. Test the application</h3>
<div class="paragraph">
<p>A good application includes test coverage.</p>
</div>
<div class="sect3">
<h4 id="_test_the_constraints"><a class="anchor" href="#_test_the_constraints"></a>9.1.1. Test the constraints</h4>
<div class="paragraph">
<p>To test each constraint in isolation, use a <code>ConstraintVerifier</code> in unit tests.
This tests each constraint&#8217;s corner cases in isolation from the other tests,
which lowers maintenance when adding a new constraint with proper test coverage.</p>
</div>
<div class="paragraph">
<p>Create the <code>src/test/java/org/acme/schooltimetabling/solver/TimeTableConstraintProviderTest.java</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.schooltimetabling.solver;

import java.time.DayOfWeek;
import java.time.LocalTime;

import org.acme.schooltimetabling.domain.Lesson;
import org.acme.schooltimetabling.domain.Room;
import org.acme.schooltimetabling.domain.TimeTable;
import org.acme.schooltimetabling.domain.Timeslot;
import org.junit.jupiter.api.Test;
import org.optaplanner.test.api.score.stream.ConstraintVerifier;

class TimeTableConstraintProviderTest {

    private static final Room ROOM1 = new Room("Room1");
    private static final Timeslot TIMESLOT1 = new Timeslot(DayOfWeek.MONDAY, LocalTime.NOON);
    private static final Timeslot TIMESLOT2 = new Timeslot(DayOfWeek.TUESDAY, LocalTime.NOON);

    ConstraintVerifier&lt;TimeTableConstraintProvider, TimeTable&gt; constraintVerifier = ConstraintVerifier.build(
            new TimeTableConstraintProvider(), TimeTable.class, Lesson.class);

    @Test
    void roomConflict() {
        Lesson firstLesson = new Lesson(1, "Subject1", "Teacher1", "Group1", TIMESLOT1, ROOM1);
        Lesson conflictingLesson = new Lesson(2, "Subject2", "Teacher2", "Group2", TIMESLOT1, ROOM1);
        Lesson nonConflictingLesson = new Lesson(3, "Subject3", "Teacher3", "Group3", TIMESLOT2, ROOM1);
        constraintVerifier.verifyThat(TimeTableConstraintProvider::roomConflict)
                .given(firstLesson, conflictingLesson, nonConflictingLesson)
                .penalizesBy(1);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This test verifies that the constraint <code>TimeTableConstraintProvider::roomConflict</code> penalizes with a  match weight of <code>1</code>
when given three lessons in the same room, where two lessons have the same timeslot.
Therefore, a constraint weight of <code>10hard</code> would reduce the score by <code>-10hard</code>.</p>
</div>
<div class="paragraph">
<p>Notice how <code>ConstraintVerifier</code> ignores the constraint weight during testing - even
if those constraint weights are hard coded in the <code>ConstraintProvider</code> - because
constraints weights change regularly before going into production.
This way, constraint weight tweaking does not break the unit tests.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_logging"><a class="anchor" href="#_logging"></a>9.2. Logging</h3>
<div class="paragraph">
<p>When adding constraints in your <code>ConstraintProvider</code>,
keep an eye on the <em>score calculation speed</em> in the <code>info</code> log,
after solving for the same amount of time, to assess the performance impact:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>... Solving ended: ..., score calculation speed (29455/sec), ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>To understand how OptaPlanner is solving your problem internally,
change the logging in the <code>logback.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">  &lt;logger name="org.optaplanner" level="debug"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use <code>debug</code> logging to show every <em>step</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code>... Solving started: time spent (67), best score (-20init/0hard/0soft), environment mode (REPRODUCIBLE), random (JDK with seed 0).
...     CH step (0), time spent (128), score (-18init/0hard/0soft), selected move count (15), picked move ([Math(101) {null -&gt; Room A}, Math(101) {null -&gt; MONDAY 08:30}]).
...     CH step (1), time spent (145), score (-16init/0hard/0soft), selected move count (15), picked move ([Physics(102) {null -&gt; Room A}, Physics(102) {null -&gt; MONDAY 09:30}]).
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use <code>trace</code> logging to show every <em>step</em> and every <em>move</em> per step.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary"><a class="anchor" href="#_summary"></a>10. Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Congratulations!
You have just developed a Java application with <a href="https://www.optaplanner.org/">OptaPlanner</a>!</p>
</div>
<div class="paragraph">
<p>If you ran into any issues,
take a look at <a href="https://github.com/kiegroup/optaplanner-quickstarts/tree/stable/hello-world">the quickstart source code</a>.</p>
</div>
<div class="paragraph">
<p>Read the next guide to build a pretty web application for school timetabling
with a REST service and database integration, by leveraging Quarkus.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../_/js/site.js"></script>
<script src="../../../../_/js/vendor/lunr-2.3.9.min.js"></script>
<script src="../../../../_/js/vendor/search.js" id="search-script" data-base-path="../../../.." data-page-path="/optaplanner/latest/quickstart/hello-world/hello-world-quickstart.html"></script>
<script async src="../../../../_/../search-index.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>

<!-- Adobe Analytics for Red Hat - DPAL (DTM Property Auto-Loader) - part 2/2 -->
<script type="text/javascript">
    if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
        _satellite.pageBottom();
    }
</script>  </body>
</html>
